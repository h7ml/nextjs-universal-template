# Deno å®Œæ•´æŒ‡å—

> æœ¬é¡¹ç›®æ”¯æŒéƒ¨ç½²åˆ° Deno Deploy å¹³å°ã€‚æœ¬æ–‡æ¡£åŒ…å«å¼€å‘ã€éƒ¨ç½²å’Œ API ä½¿ç”¨çš„å®Œæ•´è¯´æ˜ã€‚

## ğŸ“‹ ç›®å½•

- [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
- [å¼€å‘æ¨¡å¼](#å¼€å‘æ¨¡å¼)
- [API æ¥å£æ”¯æŒ](#api-æ¥å£æ”¯æŒ)
- [éƒ¨ç½²è¯¦ç»†æ­¥éª¤](#éƒ¨ç½²è¯¦ç»†æ­¥éª¤)
- [ç¯å¢ƒå˜é‡é…ç½®](#ç¯å¢ƒå˜é‡é…ç½®)
- [æ•…éšœæ’é™¤](#æ•…éšœæ’é™¤)
- [æœ€ä½³å®è·µ](#æœ€ä½³å®è·µ)

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å¯ä»¥éƒ¨ç½²ï¼

ä½ çš„é¡¹ç›®å·²ç»å‡†å¤‡å¥½éƒ¨ç½²åˆ° Deno Deploy äº†ã€‚æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤æ“ä½œï¼š

### æ–¹æ³• 1: é€šè¿‡ GitHubï¼ˆæ¨èï¼‰â­

#### 1ï¸âƒ£ å‡†å¤‡ GitHub ä»“åº“

```bash
# ç¡®ä¿ä»£ç å·²æäº¤
git add .
git commit -m "Ready for Deno Deploy"
git push origin main
```

#### 2ï¸âƒ£ è®¿é—® Deno Deploy Dashboard

1. æ‰“å¼€ [https://dash.deno.com](https://dash.deno.com)
2. ä½¿ç”¨ GitHub è´¦å·ç™»å½•

#### 3ï¸âƒ£ åˆ›å»ºæ–°é¡¹ç›®

1. ç‚¹å‡» **"New Project"**
2. é€‰æ‹© **"Deploy from GitHub"**
3. æˆæƒ Deno Deploy è®¿é—®ä½ çš„ GitHub è´¦å·
4. é€‰æ‹©ä½ çš„ä»“åº“

#### 4ï¸âƒ£ é…ç½®é¡¹ç›®

**å¿…å¡«é¡¹ï¼š**

- **Name**: `nextjs-universal-template`ï¼ˆæˆ–è‡ªå®šä¹‰ï¼‰
- **Entry Point**: `deno_server.ts` âš ï¸ é‡è¦ï¼

**ç¯å¢ƒå˜é‡ï¼ˆEnvironment Variablesï¼‰ï¼š**

ç‚¹å‡» "Environment Variables" æ·»åŠ ï¼š

```
DENO=1
NODE_ENV=production
DATABASE_URL=postgresql://user:password@host:5432/database
JWT_SECRET=your-very-secret-key-min-32-characters-long
```

âš ï¸ **é‡è¦**:

- `DATABASE_URL` æ˜¯å¿…éœ€çš„ï¼ˆå¯ä»¥ä½¿ç”¨ Neon Serverlessï¼‰
- `JWT_SECRET` å»ºè®®ä½¿ç”¨ 32+ å­—ç¬¦çš„éšæœºå­—ç¬¦ä¸²

#### 5ï¸âƒ£ éƒ¨ç½²

1. ç‚¹å‡» **"Deploy"** æŒ‰é’®
2. ç­‰å¾…éƒ¨ç½²å®Œæˆï¼ˆé€šå¸¸ 1-2 åˆ†é’Ÿï¼‰
3. è·å¾—éƒ¨ç½² URLï¼š`https://your-project.deno.dev`

### æ–¹æ³• 2: ä½¿ç”¨ Deno CLI

å¦‚æœä½ æœ‰ Deno CLI å’Œ Deno Deploy è´¦å·ï¼š

```bash
# å®‰è£… Deno Deploy CLI
deno install -A jsr:@deno/deploy-cli

# éƒ¨ç½²
deployctl deploy --project=your-project-name deno_server.ts
```

---

## ğŸ› ï¸ å¼€å‘æ¨¡å¼

### âœ… é›†æˆæ¨¡å¼ï¼ˆæ¨èï¼‰

Deno æœåŠ¡å™¨å·²ç»é…ç½®ä¸º**è‡ªåŠ¨é›†æˆ** Next.js åº”ç”¨ï¼š

#### å¼€å‘æ—¶ï¼šè‡ªåŠ¨ä»£ç†åˆ° Next.js

1. **å¯åŠ¨ Next.js**: `npm run dev` (ç»ˆç«¯ 1)
2. **å¯åŠ¨ Deno**: `deno task dev` (ç»ˆç«¯ 2)
3. **è®¿é—®**: `http://localhost:8080` - Deno ä¼šè‡ªåŠ¨ä»£ç†åˆ° Next.jsï¼

**å·¥ä½œåŸç†**:

- Deno ä¼šæ£€æµ‹ Next.js æ˜¯å¦åœ¨ `localhost:3000` è¿è¡Œ
- å¦‚æœæ˜¯ï¼Œå‰ç«¯é¡µé¢è¯·æ±‚ä¼šè‡ªåŠ¨ä»£ç†åˆ° Next.js
- API è·¯ç”±ï¼ˆ`/api/*`ï¼‰ç”± Deno ç›´æ¥å¤„ç†
- **ç»“æœ**: é€šè¿‡ Deno ä¹Ÿèƒ½çœ‹åˆ°å®Œæ•´çš„ Next.js åº”ç”¨ï¼

#### ç”Ÿäº§æ—¶ï¼šæä¾›é™æ€æ–‡ä»¶

- å¦‚æœå·²ç»æ„å»ºï¼ˆ`npm run build`ï¼‰ï¼ŒDeno ä¼šå°è¯•æä¾›æ„å»ºåçš„é™æ€æ–‡ä»¶
- é€‚åˆéƒ¨ç½²åˆ° Deno Deploy

### ğŸ“‹ ä½¿ç”¨æ–¹å¼å¯¹æ¯”

| æ–¹å¼                            | ç”¨é€”              | ç»“æœ                               |
| ------------------------------- | ----------------- | ---------------------------------- |
| `npm run dev`                   | æ ‡å‡† Next.js å¼€å‘ | âœ… å®Œæ•´åº”ç”¨                        |
| `deno task dev` + `npm run dev` | Deno é›†æˆæ¨¡å¼     | âœ… å®Œæ•´åº”ç”¨ï¼ˆé€šè¿‡ Denoï¼‰           |
| `deno task dev`                 | ä»… Deno API       | âš ï¸ ä»… APIï¼ˆé™¤é Next.js ä¹Ÿåœ¨è¿è¡Œï¼‰ |

### ğŸš€ æ¨èå¼€å‘æµç¨‹

#### æ–¹å¼ 1ï¼šé›†æˆå¼€å‘ï¼ˆæ¨èï¼‰âœ¨

```bash
# ç»ˆç«¯ 1: å¯åŠ¨ Next.js
npm run dev

# ç»ˆç«¯ 2: å¯åŠ¨ Denoï¼ˆä¼šè‡ªåŠ¨æ£€æµ‹å¹¶ä»£ç†åˆ° Next.jsï¼‰
deno task dev

# è®¿é—® http://localhost:8080 - çœ‹åˆ°å®Œæ•´çš„ Next.js åº”ç”¨ï¼
```

#### æ–¹å¼ 2ï¼šæ ‡å‡† Next.js å¼€å‘

```bash
# ä»…å¯åŠ¨ Next.js å¼€å‘æœåŠ¡å™¨
npm run dev

# è®¿é—® http://localhost:3000
```

#### æ–¹å¼ 3ï¼šä»…æµ‹è¯• Deno API

```bash
# ä»…å¯åŠ¨ Denoï¼ˆä¸ä¼šä»£ç†åˆ° Next.jsï¼‰
deno task dev

# è®¿é—® http://localhost:8080
# ä¼šæ˜¾ç¤º API æœåŠ¡å™¨ä¿¡æ¯é¡µé¢
```

### ğŸ“Š åŠŸèƒ½å¯¹æ¯”

| ç‰¹æ€§           | `npm run dev` | `deno + npm run dev`ï¼ˆé›†æˆæ¨¡å¼ï¼‰ | `deno`ï¼ˆå•ç‹¬ï¼‰     |
| -------------- | ------------- | -------------------------------- | ------------------ |
| **å‰ç«¯é¡µé¢**   | âœ… å®Œæ•´æ”¯æŒ   | âœ… å®Œæ•´æ”¯æŒï¼ˆä»£ç†ï¼‰              | âš ï¸ éœ€ Next.js è¿è¡Œ |
| **API è·¯ç”±**   | âœ… Node.js    | âœ… Deno å¤„ç†                     | âœ… Deno å¤„ç†       |
| **æœåŠ¡ç«¯æ¸²æŸ“** | âœ… æ”¯æŒ       | âœ… æ”¯æŒï¼ˆé€šè¿‡ä»£ç†ï¼‰              | âŒ ä¸æ”¯æŒ          |
| **å¼€å‘ä½“éªŒ**   | â­â­â­â­â­    | â­â­â­â­                         | â­â­               |
| **é€‚ç”¨åœºæ™¯**   | æ ‡å‡†å¼€å‘      | é›†æˆæµ‹è¯•                         | API æµ‹è¯•           |

---

## ğŸ“¡ API æ¥å£æ”¯æŒ

### âœ… å®Œå…¨æ”¯æŒçš„æ¥å£

è¿™äº›æ¥å£åœ¨ Deno Deploy ä¸­**å®Œå…¨å¯ç”¨**ï¼š

#### 1. å¥åº·æ£€æŸ¥

```bash
GET /api/health
```

**å“åº”**:

```json
{
  "status": "ok",
  "platform": "deno",
  "timestamp": "2025-01-30T..."
}
```

#### 2. å¹³å°ä¿¡æ¯

```bash
GET /api/hello
```

**å“åº”**:

```json
{
  "message": "Hello from Next.js Universal Template!",
  "platform": "Deno Deploy",
  "platformInfo": {
    "platform": "deno",
    "runtime": "edge",
    "environment": "production"
  }
}
```

#### 3. ç¯å¢ƒå˜é‡ï¼ˆå®‰å…¨ï¼‰

```bash
GET /api/env
```

**å“åº”**: ä»…è¿”å›å®‰å…¨çš„ç¯å¢ƒå˜é‡

#### 4. tRPC å¥åº·æ£€æŸ¥

```bash
GET /api/trpc/health.check
```

**å“åº”**: åŒ `/api/health`

### âš ï¸ éƒ¨åˆ†æ”¯æŒçš„æ¥å£

è¿™äº›æ¥å£åœ¨ Deno ä¸­æœ‰**åŸºç¡€æ”¯æŒ**ï¼Œå®Œæ•´åŠŸèƒ½éœ€è¦ Next.jsï¼š

#### tRPC æ¥å£

```bash
GET /api/trpc/router.procedure
POST /api/trpc/router.procedure
```

**æ”¯æŒæƒ…å†µ**:

- âœ… `/api/trpc/health.check` - å®Œå…¨æ”¯æŒ
- âš ï¸ å…¶ä»– tRPC ç«¯ç‚¹ - å¼€å‘æ—¶è‡ªåŠ¨ä»£ç†åˆ° Next.jsï¼Œç”Ÿäº§æ—¶è¿”å›æç¤º

**å¼€å‘æ¨¡å¼**:

- å¦‚æœ Next.js dev æœåŠ¡å™¨åœ¨è¿è¡Œï¼Œæ‰€æœ‰ tRPC è¯·æ±‚è‡ªåŠ¨ä»£ç†
- æä¾›å®Œæ•´çš„ tRPC åŠŸèƒ½

**ç”Ÿäº§æ¨¡å¼**:

- è¿”å›å‹å¥½çš„é”™è¯¯æç¤º
- å»ºè®®ä½¿ç”¨ Next.js ç¯å¢ƒæˆ–å®ç° REST API æ›¿ä»£

### âŒ éœ€è¦ Next.js çš„æ¥å£

è¿™äº›æ¥å£éœ€è¦å®Œæ•´çš„ Next.js ç¯å¢ƒï¼š

- `/api/users` - å®Œæ•´åŠŸèƒ½éœ€è¦ Next.js
- `/api/trpc/auth.*` - éœ€è¦æ•°æ®åº“å’Œå®Œæ•´ tRPC
- `/api/trpc/user.*` - éœ€è¦æ•°æ®åº“å’Œå®Œæ•´ tRPC
- `/api/trpc/dashboard.*` - éœ€è¦æ•°æ®åº“å’Œå®Œæ•´ tRPC

### ğŸ”„ å¼€å‘ vs ç”Ÿäº§

#### å¼€å‘æ¨¡å¼ï¼ˆæ¨èï¼‰

**åŒæ—¶è¿è¡Œ**:

```bash
# ç»ˆç«¯ 1: Next.jsï¼ˆå®Œæ•´ API æ”¯æŒï¼‰
npm run dev

# ç»ˆç«¯ 2: Denoï¼ˆä»£ç†åˆ° Next.jsï¼‰
deno task dev
```

**ç»“æœ**:

- âœ… æ‰€æœ‰ API æ¥å£å®Œå…¨å¯ç”¨
- âœ… Deno è‡ªåŠ¨ä»£ç†åˆ° Next.js
- âœ… å¯ä»¥æµ‹è¯• Deno é…ç½®

#### ç”Ÿäº§æ¨¡å¼

**Deno Deploy**:

- âœ… åŸºç¡€ API æ¥å£å¯ç”¨
- âš ï¸ tRPC æœ‰é™æ”¯æŒ
- âŒ å¤æ‚åŠŸèƒ½éœ€è¦ Next.js

**æ¨è**: ä½¿ç”¨ Vercel æˆ–æ··åˆéƒ¨ç½²

---

## ğŸ“¦ éƒ¨ç½²è¯¦ç»†æ­¥éª¤

### å‰ç½®æ¡ä»¶

- GitHub è´¦å·
- Deno Deploy è´¦å·ï¼ˆå¯é€šè¿‡ GitHub ç™»å½•ï¼‰
- PostgreSQL æ•°æ®åº“ï¼ˆæ¨è Neon Serverlessï¼Œå®Œå…¨å…¼å®¹ï¼‰

### Deno é€‚é…è¯´æ˜

#### å…³é”®å·®å¼‚

| ç‰¹æ€§     | Node.js         | Deno                 |
| -------- | --------------- | -------------------- |
| æ¨¡å—ç³»ç»Ÿ | CommonJS + ESM  | çº¯ ESM               |
| åŒ…ç®¡ç†   | npm/yarn/pnpm   | URL imports (esm.sh) |
| API      | Node.js APIs    | Web Standard APIs    |
| è¿è¡Œæ—¶   | Node.js runtime | Deno runtime         |
| æ–‡ä»¶ç³»ç»Ÿ | âœ… æ”¯æŒ         | âŒ ä¸æ”¯æŒï¼ˆåªè¯»ï¼‰    |

#### é€‚é…æ–‡ä»¶

1. **`deno_server.ts`**: Deno Deploy å…¥å£æ–‡ä»¶
2. **`deno.json`**: Deno é…ç½®ï¼ˆimports mapã€ä»»åŠ¡ï¼‰
3. **`src/db/deno.ts`**: Deno ç‰ˆæœ¬çš„æ•°æ®åº“è¿æ¥

### éƒ¨ç½²æ­¥éª¤

#### æ–¹å¼ 1: é€šè¿‡ Deno Deploy Dashboardï¼ˆæ¨èï¼‰

##### 1. å‡†å¤‡ä»£ç 

ç¡®ä¿é¡¹ç›®åŒ…å«ä»¥ä¸‹æ–‡ä»¶ï¼š

- âœ… `deno_server.ts` - Deno æœåŠ¡å™¨å…¥å£
- âœ… `deno.json` - Deno é…ç½®
- âœ… `.gitignore` - ç¡®ä¿æ’é™¤ `node_modules`

##### 2. æ¨é€åˆ° GitHub

```bash
git add .
git commit -m "Add Deno Deploy support"
git push origin main
```

##### 3. è¿æ¥ Deno Deploy

1. è®¿é—® [Deno Deploy Dashboard](https://dash.deno.com)
2. ç™»å½•ï¼ˆä½¿ç”¨ GitHub è´¦å·ï¼‰
3. ç‚¹å‡» **"New Project"**
4. é€‰æ‹© **"Deploy from GitHub"**
5. é€‰æ‹©ä»“åº“å¹¶æˆæƒ

##### 4. é…ç½®é¡¹ç›®

åœ¨é¡¹ç›®é…ç½®é¡µé¢è®¾ç½®ï¼š

- **Name**: `nextjs-universal-template`ï¼ˆæˆ–è‡ªå®šä¹‰ï¼‰
- **Entry Point**: `deno_server.ts`
- **Environment Variables**:
  ```
  DENO=1
  DATABASE_URL=postgresql://user:password@host:5432/database
  JWT_SECRET=your-jwt-secret-min-32-chars
  NODE_ENV=production
  ```

##### 5. éƒ¨ç½²

ç‚¹å‡» **"Deploy"** æŒ‰é’®ï¼Œç­‰å¾…éƒ¨ç½²å®Œæˆã€‚

##### 6. è®¿é—®

éƒ¨ç½²å®Œæˆåï¼ŒDeno Deploy ä¼šæä¾› URLï¼š

- ç”Ÿäº§: `https://your-project.deno.dev`
- é¢„è§ˆ: `https://your-project-preview.deno.dev`

#### æ–¹å¼ 2: ä½¿ç”¨ Deno CLIï¼ˆæœ¬åœ°æµ‹è¯•ï¼‰

##### 1. å®‰è£… Deno

```bash
# macOS / Linux
curl -fsSL https://deno.land/install.sh | sh

# Windows (PowerShell)
irm https://deno.land/install.ps1 | iex
```

##### 2. éªŒè¯å®‰è£…

```bash
deno --version
```

##### 3. è®¾ç½®ç¯å¢ƒå˜é‡

åˆ›å»º `.env.local` æ–‡ä»¶ï¼ˆDeno ä¼šè‡ªåŠ¨è¯»å–ï¼‰ï¼š

```bash
DATABASE_URL=postgresql://user:password@host:5432/database
JWT_SECRET=your-jwt-secret
DENO=1
```

##### 4. è¿è¡Œå¼€å‘æœåŠ¡å™¨

```bash
# ä½¿ç”¨ Deno task
deno task dev

# æˆ–ç›´æ¥è¿è¡Œ
deno run --allow-all --allow-env --allow-net deno_server.ts
```

##### 5. è®¿é—®

æ‰“å¼€æµè§ˆå™¨è®¿é—® `http://localhost:8080`

---

## ğŸ” ç¯å¢ƒå˜é‡é…ç½®

### å¿…éœ€å˜é‡

| å˜é‡å         | è¯´æ˜                  | ç¤ºä¾‹                             |
| -------------- | --------------------- | -------------------------------- |
| `DENO`         | å¹³å°æ ‡è¯†              | `1`                              |
| `NODE_ENV`     | ç¯å¢ƒç±»å‹              | `production`                     |
| `DATABASE_URL` | PostgreSQL è¿æ¥å­—ç¬¦ä¸² | `postgresql://user:pass@host/db` |
| `JWT_SECRET`   | JWT å¯†é’¥              | éšæœº 32+ å­—ç¬¦                    |

### å¯é€‰å˜é‡

| å˜é‡å | è¯´æ˜       | é»˜è®¤å€¼                         |
| ------ | ---------- | ------------------------------ |
| `PORT` | æœåŠ¡å™¨ç«¯å£ | `8080`ï¼ˆDeno Deploy è‡ªåŠ¨å¤„ç†ï¼‰ |

### åœ¨ Deno Deploy Dashboard ä¸­è®¾ç½®

1. è¿›å…¥é¡¹ç›®è®¾ç½®
2. ç‚¹å‡» **"Settings"** â†’ **"Environment Variables"**
3. æ·»åŠ å˜é‡å¹¶ç‚¹å‡» **"Save"**
4. é‡æ–°éƒ¨ç½²ä»¥åº”ç”¨æ›´æ”¹

---

## ğŸ› æ•…éšœæ’é™¤

### é—®é¢˜ 1: æ¨¡å—å¯¼å…¥é”™è¯¯

**é”™è¯¯**: `Error: Uncaught (in promise) TypeError: Cannot resolve module...`

**åŸå› **: Deno ä¸èƒ½ç›´æ¥å¯¼å…¥ npm åŒ…ï¼Œéœ€è¦ä½¿ç”¨ ESM URLã€‚

**è§£å†³**:

1. æ£€æŸ¥ `deno.json` ä¸­çš„ imports map
2. ä½¿ç”¨ `esm.sh` æˆ– `deno.land/x` ä½œä¸ºåŒ…æº
3. ç¡®ä¿æ‰€æœ‰å¯¼å…¥ä½¿ç”¨ `.ts` æ‰©å±•åï¼ˆæˆ– Deno æ”¯æŒçš„æ‰©å±•åï¼‰

### é—®é¢˜ 2: æ•°æ®åº“è¿æ¥å¤±è´¥

**é”™è¯¯**: `Error: Failed to connect to database`

**åŸå› **: Deno çš„ PostgreSQL å®¢æˆ·ç«¯é…ç½®ä¸åŒã€‚

**è§£å†³**:

1. ç¡®ä¿ä½¿ç”¨ `src/db/deno.ts` è€Œé `src/db/index.ts`
2. æ£€æŸ¥ `DATABASE_URL` æ ¼å¼æ­£ç¡®
3. å¦‚æœæ˜¯ Neon Serverlessï¼Œç¡®ä¿ä½¿ç”¨ HTTP è¿æ¥å­—ç¬¦ä¸²

### é—®é¢˜ 3: tRPC ä¸å·¥ä½œ

**é”™è¯¯**: `tRPC endpoint returns 501`

**åŸå› **: tRPC åœ¨ Deno ä¸­éœ€è¦é¢å¤–é…ç½®ã€‚

**è§£å†³**:

1. å¼€å‘æ—¶ï¼šè¿è¡Œ `npm run dev`ï¼ŒDeno ä¼šè‡ªåŠ¨ä»£ç†åˆ° Next.js
2. ç”Ÿäº§æ—¶ï¼š
   - æ–¹æ¡ˆ A: éƒ¨ç½²åˆ° Vercelï¼ˆå®Œæ•´ tRPC æ”¯æŒï¼‰
   - æ–¹æ¡ˆ B: å®ç° REST API ç«¯ç‚¹ä½œä¸ºæ›¿ä»£
   - æ–¹æ¡ˆ C: æ··åˆéƒ¨ç½²ï¼ˆå‰ç«¯ Vercelï¼ŒAPI Denoï¼‰

### é—®é¢˜ 4: ç«¯å£å†²çª

**é”™è¯¯**: `Error: Address already in use`

**è§£å†³**:

```bash
# è®¾ç½®ä¸åŒçš„ç«¯å£
export PORT=3001
deno run --allow-all deno_server.ts
```

### é—®é¢˜ 5: æƒé™é”™è¯¯

**é”™è¯¯**: `Permission denied`

**è§£å†³**:

```bash
# æˆäºˆæ‰€æœ‰æƒé™ï¼ˆå¼€å‘ç¯å¢ƒï¼‰
deno run --allow-all deno_server.ts

# æˆ–æˆäºˆç‰¹å®šæƒé™ï¼ˆç”Ÿäº§ç¯å¢ƒæ¨èï¼‰
deno run \
  --allow-env \
  --allow-net \
  --allow-read \
  deno_server.ts
```

### é—®é¢˜ 6: éƒ¨ç½²å¤±è´¥

**æ£€æŸ¥ï¼š**

- âœ… Entry Point æ˜¯å¦ä¸º `deno_server.ts`
- âœ… ç¯å¢ƒå˜é‡æ˜¯å¦éƒ½è®¾ç½®äº†
- âœ… `DATABASE_URL` æ ¼å¼æ˜¯å¦æ­£ç¡®

### é—®é¢˜ 7: é™æ€æ–‡ä»¶ä¸æ˜¾ç¤º

**åŸå› **: Deno Deploy éœ€è¦é¢„å…ˆæ„å»ºçš„é™æ€æ–‡ä»¶

**è§£å†³**:

```bash
# åœ¨ Deno Deploy ä¸­æ·»åŠ æ„å»ºæ­¥éª¤ï¼ˆå¦‚æœéœ€è¦ï¼‰
# æˆ–è€…åœ¨ GitHub Actions ä¸­æ„å»ºåéƒ¨ç½²
```

### é—®é¢˜ 8: API è¿”å› 404 æˆ– 501

**å¸¸è§æƒ…å†µ**:

- âœ… `/api/health`, `/api/hello`, `/api/env` - åº”è¯¥æ­£å¸¸å·¥ä½œ
- âš ï¸ `/api/trpc/*` - å¦‚æœä¸æ˜¯ health.checkï¼Œä¼šè¿”å› 501ï¼ˆéœ€è¦ Next.jsï¼‰
- âš ï¸ `/api/users` - è¿”å›æç¤ºä¿¡æ¯ï¼ˆéœ€è¦ Next.jsï¼‰

**è§£å†³**:

- å¼€å‘æ—¶ï¼šç¡®ä¿ Next.js dev æœåŠ¡å™¨è¿è¡Œï¼ˆ`npm run dev`ï¼‰ï¼ŒDeno ä¼šè‡ªåŠ¨ä»£ç†
- ç”Ÿäº§æ—¶ï¼šå®Œæ•´çš„ tRPC API éœ€è¦éƒ¨ç½²åˆ° Vercelï¼Œæˆ–ä½¿ç”¨ REST API æ›¿ä»£æ–¹æ¡ˆ

---

## âš ï¸ Deno Deploy çš„é™åˆ¶

### æŠ€æœ¯é™åˆ¶

1. **æ–‡ä»¶ç³»ç»Ÿåªè¯»**: ä¸èƒ½å†™å…¥æ–‡ä»¶åˆ°ç£ç›˜
2. **Next.js SSR**: ä¸æ”¯æŒå®Œæ•´çš„æœåŠ¡ç«¯æ¸²æŸ“ï¼ˆéœ€è¦ä½¿ç”¨é™æ€å¯¼å‡ºï¼‰
3. **tRPC API**: å®Œæ•´çš„ tRPC æ”¯æŒéœ€è¦ Next.js ç¯å¢ƒï¼ŒDeno æä¾›åŸºç¡€æ”¯æŒï¼š
   - âœ… å¼€å‘æ¨¡å¼ï¼šè‡ªåŠ¨ä»£ç†åˆ° Next.jsï¼ˆå¦‚æœè¿è¡Œï¼‰
   - âœ… ç”Ÿäº§æ¨¡å¼ï¼šæä¾›åŸºç¡€ REST API å’Œå¥åº·æ£€æŸ¥
   - âš ï¸ å®Œæ•´åŠŸèƒ½ï¼šæ¨èéƒ¨ç½²åˆ° Vercel æˆ–ä½¿ç”¨æ··åˆéƒ¨ç½²

### API æ”¯æŒæƒ…å†µ

| API ç±»å‹                 | Deno æ”¯æŒ | è¯´æ˜                                 |
| ------------------------ | --------- | ------------------------------------ |
| `/api/health`            | âœ… å®Œæ•´   | å¥åº·æ£€æŸ¥                             |
| `/api/hello`             | âœ… å®Œæ•´   | å¹³å°ä¿¡æ¯                             |
| `/api/env`               | âœ… å®Œæ•´   | ç¯å¢ƒå˜é‡                             |
| `/api/trpc/health.check` | âœ… åŸºç¡€   | tRPC å¥åº·æ£€æŸ¥                        |
| `/api/trpc/*`            | âš ï¸ éƒ¨åˆ†   | å¼€å‘æ—¶ä»£ç†åˆ° Next.jsï¼Œç”Ÿäº§æ—¶åŸºç¡€æ”¯æŒ |
| `/api/users`             | âš ï¸ éƒ¨åˆ†   | éœ€è¦ Next.js ç¯å¢ƒè·å–å®Œæ•´åŠŸèƒ½        |

---

## ğŸ’¡ æ¨èå·¥ä½œæµå’Œè§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆ 1: æ··åˆéƒ¨ç½²ï¼ˆæ¨èï¼‰âœ¨

- **å‰ç«¯** â†’ éƒ¨ç½²åˆ° **Vercel** æˆ– **Cloudflare Pages**
- **API** â†’ éƒ¨ç½²åˆ° **Deno Deploy**
- **ä¼˜åŠ¿**: å……åˆ†åˆ©ç”¨å„å¹³å°ä¼˜åŠ¿

### æ–¹æ¡ˆ 2: å®Œæ•´ Next.js éƒ¨ç½²

- **å…¨éƒ¨** â†’ éƒ¨ç½²åˆ° **Vercel**ï¼ˆæœ€ä½³ä½“éªŒï¼‰
- **ä¼˜åŠ¿**: å®Œæ•´æ”¯æŒæ‰€æœ‰åŠŸèƒ½

### æ–¹æ¡ˆ 3: é™æ€ + Deno API

- ä½¿ç”¨ `CF_PAGES=1 npm run build` ç”Ÿæˆé™æ€æ–‡ä»¶
- é™æ€æ–‡ä»¶ â†’ Cloudflare Pages
- API è·¯ç”± â†’ Deno Deploy

### æ–¹æ¡ˆ 4: ä½¿ç”¨ Next.jsï¼ˆæœ€ç®€å•ï¼‰

éƒ¨ç½²åˆ° **Vercel**ï¼Œè·å¾—å®Œæ•´çš„ API æ”¯æŒï¼š

- âœ… æ‰€æœ‰ tRPC æ¥å£
- âœ… æ•°æ®åº“è¿æ¥
- âœ… å®Œæ•´è®¤è¯ç³»ç»Ÿ

---

## ğŸ¯ æœ€ä½³å®è·µ

### å¼€å‘æ—¶

1. **ä½¿ç”¨ Next.js dev æœåŠ¡å™¨ + Deno ä»£ç†**ï¼ˆæµ‹è¯•é…ç½®ï¼‰
2. åˆ©ç”¨ Deno çš„è‡ªåŠ¨ä»£ç†åŠŸèƒ½æµ‹è¯•é›†æˆ

### ç”Ÿäº§æ—¶

1. **å®Œæ•´åº”ç”¨** â†’ Vercel
2. **API æœåŠ¡** â†’ Deno Deployï¼ˆä»…åŸºç¡€æ¥å£ï¼‰
3. **æ··åˆéƒ¨ç½²** â†’ å‰ç«¯ Vercelï¼ŒAPI Deno

### ç¯å¢ƒå˜é‡

1. **ä¸è¦åœ¨ä»£ç ä¸­ç¡¬ç¼–ç æ•æ„Ÿä¿¡æ¯**
2. ä½¿ç”¨ç¯å¢ƒå˜é‡ç®¡ç†æ‰€æœ‰é…ç½®

### é”™è¯¯å¤„ç†

1. **ä½¿ç”¨ try-catch åŒ…è£…æ‰€æœ‰å¼‚æ­¥æ“ä½œ**
2. æä¾›å‹å¥½çš„é”™è¯¯æç¤º

### æ—¥å¿—

1. **ä½¿ç”¨ `console.log` è¿›è¡Œè°ƒè¯•**ï¼ˆDeno Deploy ä¼šè‡ªåŠ¨æ•è·ï¼‰
2. åœ¨ Deno Deploy Dashboard æŸ¥çœ‹å®æ—¶æ—¥å¿—

### æ€§èƒ½ä¼˜åŒ–

1. **ä½¿ç”¨ HTTP/2** - Deno Deploy é»˜è®¤æ”¯æŒ
2. **è¾¹ç¼˜è®¡ç®—** - Deno Deploy è‡ªåŠ¨åœ¨å…¨çƒè¾¹ç¼˜èŠ‚ç‚¹éƒ¨ç½²
3. **è¿æ¥æ± ** - å¯¹äºæ•°æ®åº“è¿æ¥ï¼Œå»ºè®®ä½¿ç”¨è¿æ¥æ± 

---

## ğŸ“ æ€»ç»“

### Deno Deploy é€‚åˆï¼š

- âœ… ç®€å•çš„ API æœåŠ¡
- âœ… å¥åº·æ£€æŸ¥
- âœ… å¹³å°ä¿¡æ¯æŸ¥è¯¢
- âœ… Edge è®¡ç®—ä»»åŠ¡

### ä¸é€‚åˆï¼š

- âŒ å¤æ‚çš„ tRPC è·¯ç”±
- âŒ éœ€è¦å®Œæ•´æ•°æ®åº“æ“ä½œçš„åº”ç”¨
- âŒ Next.js ç‰¹å®šçš„åŠŸèƒ½

### å»ºè®®

å¯¹äºå®Œæ•´çš„ Next.js åº”ç”¨ï¼Œä½¿ç”¨ Vercel éƒ¨ç½²ï¼›Deno Deploy é€‚åˆç®€å•çš„è¾¹ç¼˜ APIã€‚

---

## ğŸ“š ç›¸å…³èµ„æº

- [Deno Deploy å®˜æ–¹æ–‡æ¡£](https://deno.com/deploy/docs)
- [Deno æ‰‹å†Œ](https://deno.land/manual)
- [esm.sh CDN](https://esm.sh) - npm åŒ…çš„ ESM CDN
- [Fresh Framework](https://fresh.deno.dev/) - Deno åŸç”Ÿ Web æ¡†æ¶

---

**æœ€åæ›´æ–°**: 2025-01-30
